---
Categories:
- "Projects"
Description: "A work in progress: Some summary data on coffee"
Tags:
- "coffee"
date: 2017-04-24T11:34:32+01:00
title: "Coffee"
---

## Introduction

This is a work in progress, but an attempt to collect publicly available data on the coffee market in one place for easy access. For example:

*  Prices: futures prices on the New York and London markets
*  Production/Consumption: data from the ICO and USDA, as well as potentially national coffee agencies etc. 
*  Trade: sources include ICO, USDA, WTO, UN Comtrade

### Prices

Daily prices of the 2nd/3rd position average for Arabica (on the New York market) and Robusta (London). 

```{r, echo = FALSE, message = FALSE, error = FALSE, warning = FALSE}
library(tidyverse);library(plotly);library(Quandl);library(lubridate)
basedir <- "~/Dropbox/Work/coffeestats"
startDate <- today() - years(2)
ny <- data_frame(
    contractMonth = rep(c("March", "May", "July", "September", "December"), 4),
    contractNum = rep(c(3, 5, 7, 9, 12), 4),
    contractSymbol = rep(c("H", "K", "N", "U", "Z"), 4),
    contractYear = c(rep(year(startDate), 5), rep(year(startDate) + 1, 5), 
                     rep(year(startDate) + 2, 5), rep(year(startDate) + 3, 5))
) %>% 
    filter(contractNum >= month(startDate)) %>% 
    mutate(QuandlSymbol = paste0("ICE/KC", contractSymbol, contractYear))

ldn <- data_frame(
    contractMonth = rep(c("January", "March", "May", "July", "September", "November"), 4),
    contractNum = rep(c(1, 3, 5, 7, 9, 11), 4),
    contractSymbol = rep(c("F", "H", "K", "N", "U", "X"), 4),
    contractYear = c(rep(year(startDate), 6), rep(year(startDate) + 1, 6), 
                     rep(year(startDate) + 2, 6), rep(year(startDate) + 3, 6))
) %>% 
    filter(contractNum >= month(startDate)) %>% 
    mutate(QuandlSymbol = paste0("LIFFE/RC", contractSymbol, contractYear))

# Go get the Quandl data, and only keep the date and settle columns. 
source(file.path(basedir, "scripts", "setQuandl.R"))
nyRaw <- Quandl(ny$QuandlSymbol, start_date = startDate) %>% 
    select(c(Date, contains("Settle"))) 

nyClean <- nyRaw %>% 
    gather(., -Date, key = series, value = price) %>% 
    # Need to change the Quandl code back to match earlier, and give it order
    mutate(series = paste0("ICE/", substr(series, 5, 11))) %>% 
    mutate(series = ordered(series, levels = ny$QuandlSymbol)) %>% 
    # Can remove NAs
    na.omit() %>% 
    # Then just group by date and take average of second and third
    group_by(Date) %>% 
    arrange(series) %>% 
    mutate(nyAv = mean(price[2], price[3])) %>% 
    ungroup() %>% 
    dplyr::distinct(Date, nyAv) %>% 
    arrange(Date)

ldnRaw <- Quandl(ldn$QuandlSymbol, start_date = startDate) %>% 
    select(c(Date, contains("Settle")))
ldnClean <- ldnRaw %>% 
    gather(., -Date, key = series, value = price) %>% 
    mutate(series = paste0("LIFFE/", substr(series, 7, 13))) %>% 
    mutate(series = ordered(series, levels = ldn$QuandlSymbol)) %>% 
    na.omit() %>% 
    group_by(Date) %>% 
    arrange(series) %>% 
    mutate(ldnAv = mean(price[2], price[3])) %>% 
    ungroup() %>% 
    dplyr::distinct(Date, ldnAv) %>% 
    arrange(Date)
```

```{r, echo = FALSE, out.width="100%"}
p1 <- plot_ly(data = nyClean,
        x = ~Date, 
        y = ~nyAv,
        type = "scatter",
        mode = "lines")

p2 <- plot_ly(data = ldnClean,
        x = ~Date, 
        y = ~ldnAv,
        type = "scatter",
        mode = "lines")
subplot(p1, p2)
```

